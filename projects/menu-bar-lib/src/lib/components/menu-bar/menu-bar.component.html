<!-- Menu Sidebar -->
<div class="menu-sidebar" [class.collapsed]="isCollapsed()">
  <!-- Sidebar Header -->
  <div class="sidebar-header">
    <div class="header-content" *ngIf="!isCollapsed()">
      <div class="role-info">
        <i class="fa fa-user-circle role-icon"></i>
        <div class="role-details">
          <div class="role-name">
            {{ currentRole()?.description || "Menu" }}
          </div>
          <div class="role-code" *ngIf="currentRole()?.isPriorityRole">
            <i class="fa fa-star"></i>
            Priority Role
          </div>
        </div>
      </div>
    </div>

    <button
      class="toggle-btn"
      (click)="toggleSidebar()"
      [title]="isCollapsed() ? 'Expand' : 'Collapse'"
    >
      <i
        class="fa"
        [class.fa-bars]="isCollapsed()"
        [class.fa-times]="!isCollapsed()"
      ></i>
    </button>
  </div>

  <!-- Search Bar -->
  <div class="search-section" *ngIf="!isCollapsed() && config().enableSearch">
    <div class="search-toggle">
      <button class="icon-btn" (click)="toggleSearch()" title="Search Menu">
        <i class="fa fa-search"></i>
      </button>
    </div>

    <div class="search-box" *ngIf="showSearch()">
      <input
        type="text"
        [value]="searchText()"
        (input)="onSearch()"
        name="searchText"
        placeholder="Search tasks..."
        class="search-input"
      />
      <button
        class="clear-search-btn"
        *ngIf="searchText()"
        (click)="clearSearch()"
      >
        <i class="fa fa-times"></i>
      </button>
    </div>

    <!-- Search Results -->
    <div class="search-results" *ngIf="searchResults().length > 0">
      <div class="results-header">
        <span>{{ searchResults().length }} results</span>
        <button class="close-results-btn" (click)="clearSearch()">
          <i class="fa fa-times"></i>
        </button>
      </div>
      <div class="results-list">
        <div
          *ngFor="let result of searchResults(); trackBy: trackBySearchResult"
          class="result-item"
          (click)="onTaskClick(menuBarService.findTaskByCode(result.taskCode)!)"
        >
          <i class="fa fa-file result-icon"></i>
          <div class="result-content">
            <div class="result-title">{{ result.caption }}</div>
            <div class="result-path">{{ result.path }}</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Toolbar -->
  <div class="toolbar" *ngIf="!isCollapsed()">
    <button class="tool-btn" (click)="expandAll()" title="Expand All">
      <i class="fa fa-plus-square"></i>
    </button>
    <button class="tool-btn" (click)="collapseAll()" title="Collapse All">
      <i class="fa fa-minus-square"></i>
    </button>
    <button
      class="tool-btn"
      [class.active]="config().showTaskCodes"
      (click)="toggleTaskCodes()"
      title="Toggle Task Codes"
    >
      <i class="fa fa-code"></i>
    </button>
    <button
      class="tool-btn"
      [class.active]="config().viewMode === MenuViewMode.LIST"
      (click)="switchViewMode(MenuViewMode.LIST)"
      title="List View"
    >
      <i class="fa fa-list"></i>
    </button>
    <button
      class="tool-btn"
      [class.active]="config().viewMode === MenuViewMode.GRAPHICAL"
      (click)="switchViewMode(MenuViewMode.GRAPHICAL)"
      title="Graphical View"
    >
      <i class="fa fa-th"></i>
    </button>
  </div>

  <!-- Menu Groups -->
  <div class="menu-content" *ngIf="!isCollapsed()">
    <div
      *ngFor="let group of menuGroups(); trackBy: trackByMenuCode"
      class="menu-group"
      [class.expanded]="group.isExpanded"
    >
      <!-- Group Header -->
      <div class="group-header" (click)="toggleGroup(group.menuCode)">
        <i class="fa {{ group.icon }} group-icon"></i>
        <span class="group-title">{{ group.description }}</span>
        <i
          class="fa expand-icon"
          [class.fa-chevron-down]="!group.isExpanded"
          [class.fa-chevron-up]="group.isExpanded"
        ></i>
      </div>

      <!-- Group Tasks -->
      <div class="group-tasks" *ngIf="group.isExpanded">
        <!-- List View -->
        <div *ngIf="config().viewMode === MenuViewMode.LIST" class="tasks-list">
          <div
            *ngFor="let task of group.tasks; trackBy: trackByTaskCode"
            class="task-item"
            [class.favorite]="isFavorite(task.taskCode)"
            (click)="onTaskClick(task)"
          >
            <i class="fa {{ task.icon }} task-icon"></i>
            <div class="task-content">
              <div class="task-title">
                {{ task.caption }}
                <span class="task-code" *ngIf="config().showTaskCodes">
                  {{ task.taskCode }}
                </span>
              </div>
              <div class="task-description" *ngIf="task.description">
                {{ task.description }}
              </div>
            </div>
            <button
              class="favorite-btn"
              (click)="toggleFavorite(task, $event)"
              [class.active]="isFavorite(task.taskCode)"
              [title]="
                isFavorite(task.taskCode)
                  ? 'Remove from favorites'
                  : 'Add to favorites'
              "
            >
              <i
                class="fa"
                [class.fa-star]="isFavorite(task.taskCode)"
                [class.fa-star-o]="!isFavorite(task.taskCode)"
              ></i>
            </button>
          </div>
        </div>

        <!-- Graphical View -->
        <div
          *ngIf="config().viewMode === MenuViewMode.GRAPHICAL"
          class="tasks-grid"
        >
          <div
            *ngFor="let task of group.tasks; trackBy: trackByTaskCode"
            class="task-card"
            [class.favorite]="isFavorite(task.taskCode)"
            (click)="onTaskClick(task)"
          >
            <div class="card-icon">
              <i class="fa {{ task.icon }}"></i>
            </div>
            <div class="card-title">{{ task.caption }}</div>
            <div class="card-code" *ngIf="config().showTaskCodes">
              {{ task.taskCode }}
            </div>
            <button
              class="card-favorite-btn"
              (click)="toggleFavorite(task, $event)"
              [class.active]="isFavorite(task.taskCode)"
            >
              <i
                class="fa"
                [class.fa-star]="isFavorite(task.taskCode)"
                [class.fa-star-o]="!isFavorite(task.taskCode)"
              ></i>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Empty State -->
    <div class="empty-state" *ngIf="menuGroups().length === 0">
      <i class="fa fa-folder-open"></i>
      <p>No menu items available</p>
    </div>
  </div>

  <!-- Collapsed State Icons -->
  <div class="collapsed-menu" *ngIf="isCollapsed()">
    <div
      *ngFor="let group of menuGroups(); trackBy: trackByMenuCode"
      class="collapsed-item"
      [title]="group.description"
    >
      <i class="fa {{ group.icon }}"></i>
    </div>
  </div>
</div>
