<div
  class="tab-content-container"
  [class.fullscreen]="isFullscreen"
  [class.hidden]="!isVisible()"
>
  <!-- Loading State -->
  <div class="loading-overlay" *ngIf="tab.state === TabState.LOADING">
    <div class="loading-spinner">
      <div class="spinner"></div>
      <div class="loading-text">Loading {{ tab.title }}...</div>
      <div
        class="progress-bar"
        *ngIf="loadProgress() > 0 && loadProgress() < 100"
      >
        <div class="progress" [style.width.%]="loadProgress()"></div>
      </div>
    </div>
  </div>

  <!-- Error State -->
  <div class="error-state" *ngIf="tab.state === TabState.ERROR">
    <div class="error-icon">
      <i class="fa fa-exclamation-triangle"></i>
    </div>
    <div class="error-message">
      <h3>Failed to Load Content</h3>
      <p>
        {{ tab.error || "An unknown error occurred while loading this task" }}
      </p>
      <div class="error-actions">
        <button class="retry-btn" (click)="reload()">
          <i class="fa fa-refresh"></i> Retry
        </button>
        <button
          class="close-btn"
          (click)="stateChanged.emit({ tabId: tab.id, state: TabState.IDLE })"
        >
          <i class="fa fa-times"></i> Close
        </button>
      </div>
    </div>
  </div>

  <!-- Minimized State -->
  <div class="minimized-state" *ngIf="tab.isMinimized">
    <div class="minimized-icon">
      <i class="fa fa-window-minimize"></i>
    </div>
    <div class="minimized-message">
      <h3>{{ tab.title }}</h3>
      <p>This tab is minimized</p>
    </div>
  </div>

  <!-- Iframe Content -->
  <div
    class="iframe-container"
    *ngIf="tab.type === TabType.IFRAME"
    [class.hidden]="tab.state !== TabState.LOADED || tab.isMinimized"
  >
    <iframe
      #iframe
      [src]="safeUrl()"
      [title]="tab.title"
      [id]="tab.id"
      (load)="onIframeLoad()"
      (error)="onIframeError($event)"
      class="content-iframe"
      [class.fullscreen]="isFullscreen"
      frameborder="0"
      allowfullscreen
    ></iframe>
  </div>

  <!-- Angular Route Content -->
  <div class="route-container" *ngIf="tab.type === TabType.ROUTE">
    <router-outlet></router-outlet>
  </div>

  <!-- Unsaved Changes Indicator -->
  <div class="unsaved-indicator" *ngIf="tab.metadata?.hasUnsavedChanges">
    <i class="fa fa-circle"></i>
    <span>Unsaved changes</span>
  </div>
</div>
