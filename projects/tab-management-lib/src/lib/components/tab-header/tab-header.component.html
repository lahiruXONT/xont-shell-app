<div class="tab-header-container">
  <div
    class="tabs-list"
    cdkDropList
    cdkDropListOrientation="horizontal"
    (cdkDropListDropped)="onDrop($event)"
  >
    <div
      *ngFor="let tab of tabManager.tabs(); trackBy: trackByTab"
      class="tab-item"
      [class.active]="tab.isActive"
      [class.pinned]="tab.isPinned"
      [class.dirty]="tab.isDirty"
      cdkDrag
      (click)="onTabClick(tab)"
      (contextmenu)="onTabContextMenu($event, tab.id)"
    >
      <!-- Pin Icon -->
      <i *ngIf="tab.isPinned" class="fa fa-thumbtack pin-icon"></i>

      <!-- Tab Icon -->
      <i class="fa {{ tab.icon }} tab-icon" *ngIf="!tab.isPinned"></i>

      <!-- Tab Title -->
      <span class="tab-title">
        {{ tab.title }}
        <span *ngIf="tab.isDirty" class="dirty-indicator">*</span>
      </span>

      <!-- Loading Indicator -->
      <span *ngIf="tab.state === 'LOADING'" class="loading-spinner"></span>

      <!-- Close Button -->
      <button
        class="close-btn"
        (click)="onCloseTab($event, tab.id)"
        [disabled]="tab.metadata?.canClose === false"
      >
        <i class="fa fa-times"></i>
      </button>

      <!-- Context Menu -->
      <div class="tab-context-menu" *ngIf="showTabMenu() === tab.id">
        <button (click)="onPinTab(tab.id)">
          <i
            class="fa"
            [class.fa-thumbtack]="!tab.isPinned"
            [class.fa-times]="tab.isPinned"
          ></i>
          {{ tab.isPinned ? "Unpin" : "Pin" }} Tab
        </button>
        <button (click)="onRefreshTab(tab.id)">
          <i class="fa fa-sync"></i> Refresh
        </button>
        <button (click)="onCloseOtherTabs(tab.id)">
          <i class="fa fa-window-close"></i> Close Others
        </button>
        <button (click)="onCloseAllTabs()">
          <i class="fa fa-times-circle"></i> Close All
        </button>
      </div>
    </div>
  </div>

  <!-- Tab Tools -->
  <div class="tab-tools" *ngIf="tabManager.config().showToolsMenu">
    <button class="tool-btn" title="Close All Tabs" (click)="onCloseAllTabs()">
      <i class="fa fa-times-circle"></i>
    </button>
  </div>
</div>

<!-- Backdrop to close context menu -->
<div class="menu-backdrop" *ngIf="showTabMenu()" (click)="closeMenu()"></div>
