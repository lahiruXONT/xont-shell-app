<mat-toolbar color="primary" class="top-nav-container">
  <div class="container-fluid d-flex align-items-center">
    <!-- Logo -->
    @if (showLogo) {
    <a class="navbar-brand me-auto" (click)="logoClicked.emit()">
      <img
        src="assets/images/logo-v2.png"
        alt="VENTURA CRM"
        class="img-fluid"
        style="max-height: 40px"
      />
    </a>
    }

    <!-- Business Unit Display -->
    @if (showBusinessUnit && user) {
    <span class="d-flex align-items-center me-3">
      <mat-icon class="me-1">business</mat-icon>
      <span class="bu-name">{{ user.currentBusinessUnit }}</span>
    </span>
    }

    <!-- Notifications -->
    @if (showNotifications) {
    <button
      mat-icon-button
      (click)="openNotifications()"
      title="Notifications"
      class="me-2"
      [matBadge]="hasUnreadNotifications() ? getNotificationCountDisplay() : ''"
      matBadgeColor="warn"
      matBadgeOverlap="true"
    >
      <mat-icon>notifications</mat-icon>
    </button>
    }

    <!-- User Menu -->
    @if (showUserMenu && user) {
    <button mat-button [matMenuTriggerFor]="userMenu" class="user-menu-trigger">
      <img
        class="avatar rounded-circle me-2"
        [src]="userProfile().profileImage"
        (error)="onAvatarError($event)"
        width="36"
        height="36"
        [alt]="userProfile().fullName"
      />
      <span class="avatar-name d-none d-md-inline">{{
        userProfile().userName
      }}</span>
      <mat-icon>arrow_drop_down</mat-icon>
    </button>
    <mat-menu #userMenu="matMenu">
      <button mat-menu-item (click)="openSettings()">
        <mat-icon></mat-icon>
        <span>Settings</span>
      </button>
      <button mat-menu-item (click)="openVersionInfo()">
        <mat-icon></mat-icon>
        <span>Version Info.</span>
      </button>
      <button mat-menu-item (click)="openAbout()">
        <mat-icon></mat-icon>
        <span>About</span>
      </button>
      <mat-divider></mat-divider>
      <button mat-menu-item (click)="onLogout()">
        <mat-icon></mat-icon>
        <span>Logout</span>
      </button>
    </mat-menu>

    <!-- Role/BU Selector -->
    <lib-role-selector
      [roles]="user.roles"
      [currentRole]="user.currentRole"
      [businessUnits]="user.businessUnits"
      [currentBusinessUnit]="user.currentBusinessUnit"
      (rolesChanged)="onRolesChanged($event)"
      class="ms-2"
    ></lib-role-selector>
    }
  </div>
</mat-toolbar>

<!-- Notifications Panel (slides from right) -->
@if (showNotificationsPanel()) {
<lib-notifications-panel></lib-notifications-panel>
}
