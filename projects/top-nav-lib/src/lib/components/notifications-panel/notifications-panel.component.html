<!-- Notifications Sidebar Panel -->
<!-- Legacy: notificationsideNav -->
<div
  class="sidenav notification-panel"
  [class.open]="panelState().isOpen"
  id="notificationSideNav"
>
  <div class="sidebar-inner">
    <!-- Panel Header -->
    <div class="notification-header">
      <h4 class="sidebar-title">
        <i class="fa fa-bell"></i>
        Notifications @if (unreadCount() > 0) {
        <span class="unread-badge">{{ unreadCount() }}</span>
        }
      </h4>
      <button class="close-btn" (click)="closePanel()" type="button">
        <i class="fa fa-close"></i>
      </button>
    </div>

    <!-- Action Buttons -->
    <div class="notification-actions">
      @if (hasNotifications()) {
      <button
        class="btn btn-sm btn-primary"
        (click)="markAllAsRead()"
        [disabled]="unreadCount() === 0"
        type="button"
      >
        <i class="fa fa-check-double"></i>
        Mark All Read
      </button>

      @if (hasSelectedNotifications()) {
      <button
        class="btn btn-sm btn-danger"
        (click)="deleteSelected()"
        type="button"
      >
        <i class="fa fa-trash"></i>
        Delete ({{ selectedNotifications().size }})
      </button>
      } }
    </div>

    <!-- Notifications List -->
    <div class="notifications-container">
      @if (!isMessageViewOpen()) {
      <!-- List View -->
      @if (hasNotifications()) {
      <ul class="notification-list" id="sideNav">
        @for (notification of notifications(); track notification.id) {
        <li [class]="getNotificationClass(notification)">
          <!-- Selection Checkbox -->
          <div class="notification-checkbox">
            <input
              type="checkbox"
              [id]="'notif-check-' + notification.id"
              [checked]="isSelected(notification.id)"
              (change)="toggleNotificationSelection(notification.id)"
            />
            <label [for]="'notif-check-' + notification.id"></label>
          </div>

          <!-- Notification Content -->
          <div
            class="notification-content"
            (click)="onNotificationClick(notification)"
          >
            <div class="notification-icon">
              <i [class]="'fa ' + getNotificationIcon(notification)"></i>
            </div>

            <div class="notification-details">
              <div class="notification-title">
                {{ notification.title }}
              </div>
              <div class="notification-message">
                {{ notification.message }}
              </div>
              <div class="notification-meta">
                <span class="notification-time">
                  {{ formatTimestamp(notification.timestamp) }}
                </span>
                @if (notification.type === NotificationType.TASK &&
                notification.taskCode) {
                <span class="notification-task-code">
                  <i class="fa fa-code"></i>
                  {{ notification.taskCode }}
                </span>
                }
              </div>
            </div>

            @if (!notification.isRead) {
            <div class="unread-indicator"></div>
            }
          </div>
        </li>
        }
      </ul>
      } @else {
      <!-- Empty State -->
      <div class="empty-state">
        <i class="fa fa-bell-slash"></i>
        <p>No notifications</p>
      </div>
      } } @else {
      <!-- Message View -->
      <div class="message-view">
        <div class="message-header">
          <button class="back-btn" (click)="closeMessageView()" type="button">
            <i class="fa fa-arrow-left"></i>
            Back
          </button>
        </div>

        <div class="message-content">
          @if (panelState().selectedNotification; as notification) {
          <div class="message-title">
            <i [class]="'fa ' + getNotificationIcon(notification)"></i>
            {{ notification.title }}
          </div>

          <div class="message-timestamp">
            {{ formatTimestamp(notification.timestamp) }}
          </div>

          <div class="message-body">
            {{ notification.message }}
          </div>

          @if (notification.actionUrl) {
          <div class="message-actions">
            <a
              [href]="notification.actionUrl"
              class="btn btn-primary"
              target="_blank"
            >
              {{ notification.actionText || "View Details" }}
            </a>
          </div>
          } }
        </div>
      </div>
      }
    </div>
  </div>
</div>

<!-- Backdrop (click to close) -->
@if (panelState().isOpen) {
<div class="notification-backdrop" (click)="closePanel()"></div>
}
