<!-- Settings Modal -->
<!-- Legacy: settingsModal -->
@if (modalState().isOpen) {
<div class="modalDialog2 fade in settings-modal">
  <div class="s-content">
    <!-- Modal Header -->
    <div class="s-header">
      <h4 class="s-title">Settings</h4>
      <button class="close-btn" (click)="closeModal()" type="button">
        <i class="fa fa-close"></i>
      </button>
    </div>

    <!-- Tab Navigation -->
    <div class="tab-navigation">
      <button
        class="tab-btn"
        [class.active]="modalState().activeTab === 'theme'"
        (click)="switchTab('theme')"
        type="button"
      >
        <i class="fa fa-palette"></i>
        Theme
      </button>
      <button
        class="tab-btn"
        [class.active]="modalState().activeTab === 'account'"
        (click)="switchTab('account')"
        type="button"
      >
        <i class="fa fa-user"></i>
        Account
      </button>
      <button
        class="tab-btn"
        [class.active]="modalState().activeTab === 'profile'"
        (click)="switchTab('profile')"
        type="button"
      >
        <i class="fa fa-image"></i>
        Profile Picture
      </button>
    </div>

    <!-- Modal Body -->
    <div class="s-body">
      <!-- Theme Tab -->
      @if (modalState().activeTab === 'theme') {
      <div class="tab-content theme-tab">
        <!-- Theme Selection -->
        <div class="setting-section">
          <h5 class="section-title">Themes</h5>
          <div class="theme-options">
            @for (theme of availableThemes; track theme.name) {
            <div
              class="theme-option"
              [class.selected]="isThemeSelected(theme)"
              (click)="onThemeSelect(theme)"
            >
              <div class="theme-icon">
                <i
                  [class]="'fa ' + getThemeIcon(theme.name)"
                  [style.color]="getThemeColor(theme)"
                ></i>
              </div>
              <div class="theme-name">{{ theme.displayName }}</div>
              @if (isThemeSelected(theme)) {
              <div class="selected-indicator">
                <i class="fa fa-check"></i>
              </div>
              }
            </div>
            }
          </div>
        </div>

        <!-- Font Settings -->
        <div class="setting-section">
          <h5 class="section-title">Fonts</h5>
          <div class="font-settings">
            <!-- Font Family -->
            <div class="form-group">
              <label>Font Family</label>
              <select
                class="form-control"
                [value]="tempSettings().fontFamily"
                (change)="onFontFamilyChange($any($event.target).value)"
              >
                @for (font of fontOptions.availableFonts; track font.name) {
                <option [value]="font.name">{{ font.displayName }}</option>
                }
              </select>
            </div>

            <!-- Font Size -->
            <div class="form-group">
              <label>Font Size</label>
              <select
                class="form-control"
                [value]="tempSettings().fontSize"
                (change)="onFontSizeChange($any($event.target).value)"
              >
                @for (size of fontOptions.availableSizes; track size.value) {
                <option [value]="size.value">{{ size.label }}</option>
                }
              </select>
            </div>

            <!-- Font Color -->
            <div class="form-group">
              <label>Font Color</label>
              <input
                type="color"
                class="form-control color-picker"
                [value]="tempSettings().fontColor || '#000000'"
                (change)="onFontColorChange($any($event.target).value)"
              />
            </div>
          </div>
        </div>

        <!-- Language Settings -->
        <div class="setting-section">
          <h5 class="section-title">Language</h5>
          <select
            class="form-control"
            [value]="tempSettings().language"
            (change)="onLanguageChange($any($event.target).value)"
          >
            @for (lang of languages; track lang.code) {
            <option [value]="lang.code">{{ lang.name }}</option>
            }
          </select>
        </div>
      </div>
      }

      <!-- Account Tab -->
      @if (modalState().activeTab === 'account') {
      <div class="tab-content account-tab">
        <div class="setting-section">
          <h5 class="section-title">Change Password</h5>
          <form [formGroup]="passwordForm" class="password-form">
            <!-- Current Password -->
            <div class="form-group">
              <label>Current Password</label>
              <input
                type="password"
                class="form-control"
                formControlName="currentPassword"
                placeholder="Enter current password"
              />
            </div>

            <!-- New Password -->
            <div class="form-group">
              <label>New Password</label>
              <input
                type="password"
                class="form-control"
                formControlName="newPassword"
                placeholder="Enter new password"
              />
              @if (passwordForm.get('newPassword')?.hasError('minlength')) {
              <small class="error-text">
                Password must be at least 8 characters
              </small>
              }
            </div>

            <!-- Confirm Password -->
            <div class="form-group">
              <label>Confirm New Password</label>
              <input
                type="password"
                class="form-control"
                formControlName="confirmNewPassword"
                placeholder="Re-enter new password"
              />
              @if (passwordForm.hasError('passwordMismatch')) {
              <small class="error-text">Passwords do not match</small>
              }
            </div>

            @if (passwordError()) {
            <div class="alert alert-danger">
              {{ passwordError() }}
            </div>
            }

            <button
              type="button"
              class="btn btn-primary"
              (click)="changePassword()"
              [disabled]="passwordForm.invalid || isSaving()"
            >
              Change Password
            </button>
          </form>
        </div>
      </div>
      }

      <!-- Profile Picture Tab -->
      @if (modalState().activeTab === 'profile') {
      <div class="tab-content profile-tab">
        <div class="setting-section">
          <h5 class="section-title">Profile Picture</h5>

          <!-- File Upload -->
          <div class="upload-area">
            <input
              type="file"
              id="profileImageInput"
              accept=".jpg,.jpeg,.png"
              (change)="onFileSelect($event)"
              style="display: none"
            />
            <label for="profileImageInput" class="upload-label">
              <i class="fa fa-upload"></i>
              Choose Image
            </label>
            <small class="upload-hint"> JPG, JPEG, or PNG. Max 300KB. </small>
          </div>

          <!-- Image Preview -->
          @if (profileImagePreview()) {
          <div class="image-preview">
            <img [src]="profileImagePreview()!" alt="Preview" />
            <button
              type="button"
              class="btn btn-primary"
              (click)="uploadProfileImage()"
              [disabled]="isSaving()"
            >
              Upload Image
            </button>
          </div>
          } @if (uploadError()) {
          <div class="alert alert-danger">
            {{ uploadError() }}
          </div>
          }
        </div>
      </div>
      }
    </div>

    <!-- Modal Footer -->
    <div class="s-footer">
      <button
        type="button"
        class="btn btn-default"
        (click)="resetToDefault()"
        [disabled]="isSaving()"
      >
        Reset to Default
      </button>
      <button
        type="button"
        class="btn btn-primary"
        (click)="saveSettings()"
        [disabled]="isSaving() || !modalState().hasUnsavedChanges"
      >
        @if (isSaving()) {
        <i class="fa fa-spinner fa-spin"></i>
        Saving... } @else { Save Settings }
      </button>
    </div>
  </div>
</div>

<!-- Backdrop -->
<div class="modal-backdrop" (click)="closeModal()"></div>
}
