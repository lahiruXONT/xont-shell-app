<div class="modal-overlay" [class.active]="isOpen()" (click)="close()">
  <div class="modal-container" (click)="$event.stopPropagation()">
    <!-- Modal Header -->
    <div class="modal-header">
      <h2 class="modal-title">
        <i class="fa fa-cog"></i>
        Settings
      </h2>
      <button class="close-btn" (click)="close()">
        <i class="fa fa-times"></i>
      </button>
    </div>

    <!-- Tabs -->
    <div class="modal-tabs">
      <button
        class="tab-btn"
        [class.active]="activeTab() === 'theme'"
        (click)="switchTab('theme')"
      >
        <i class="fa fa-palette"></i>
        Theme & Appearance
      </button>
      <button
        class="tab-btn"
        [class.active]="activeTab() === 'account'"
        (click)="switchTab('account')"
      >
        <i class="fa fa-user"></i>
        Account
      </button>
      <button
        class="tab-btn"
        [class.active]="activeTab() === 'profile'"
        (click)="switchTab('profile')"
      >
        <i class="fa fa-id-card"></i>
        Profile
      </button>
    </div>

    <!-- Modal Body -->
    <div class="modal-body">
      <!-- Theme Tab -->
      <div class="tab-content" *ngIf="activeTab() === 'theme'">
        <div class="form-section">
          <h3 class="section-title">Theme Selection</h3>
          <div class="theme-grid">
            <div
              *ngFor="let theme of availableThemes"
              class="theme-card"
              [class.selected]="selectedTheme() === theme.name"
              (click)="selectedTheme.set(theme.name); onThemeChange()"
            >
              <div
                class="theme-preview"
                [style.background]="theme.primaryColor"
              ></div>
              <div class="theme-name">{{ theme.displayName }}</div>
              <i
                class="fa fa-check-circle theme-check"
                *ngIf="selectedTheme() === theme.name"
              ></i>
            </div>
          </div>
        </div>

        <div class="form-section">
          <h3 class="section-title">Font Settings</h3>

          <div class="form-group">
            <label>Font Family</label>
            <select [(ngModel)]="selectedFont" class="form-control">
              <option
                *ngFor="let font of fontOptions.availableFonts"
                [value]="font.name"
              >
                {{ font.displayName }}
              </option>
            </select>
          </div>

          <div class="form-group">
            <label>Font Size</label>
            <select [(ngModel)]="selectedFontSize" class="form-control">
              <option
                *ngFor="let size of fontOptions.availableSizes"
                [value]="size.value"
              >
                {{ size.label }}
              </option>
            </select>
          </div>

          <div class="form-group">
            <label>Font Color</label>
            <input
              type="color"
              [(ngModel)]="selectedFontColor"
              class="color-picker"
            />
            <span class="color-value">{{ selectedFontColor() }}</span>
          </div>
        </div>

        <div class="form-actions">
          <button
            class="btn btn-primary"
            (click)="saveSettings()"
            [disabled]="isSaving()"
          >
            <i class="fa fa-save"></i>
            {{ isSaving() ? "Saving..." : "Save Theme Settings" }}
          </button>
        </div>
      </div>

      <!-- Account Tab -->
      <div class="tab-content" *ngIf="activeTab() === 'account'">
        <div class="form-section">
          <h3 class="section-title">Change Password</h3>

          <div class="form-group">
            <label>Current Password</label>
            <input
              type="password"
              [(ngModel)]="passwordChange().currentPassword"
              class="form-control"
              placeholder="Enter current password"
            />
          </div>

          <div class="form-group">
            <label>New Password</label>
            <input
              type="password"
              [(ngModel)]="passwordChange().newPassword"
              class="form-control"
              placeholder="Enter new password"
            />
          </div>

          <div class="form-group">
            <label>Confirm New Password</label>
            <input
              type="password"
              [(ngModel)]="passwordChange().confirmNewPassword"
              class="form-control"
              placeholder="Confirm new password"
            />
          </div>

          <div class="form-actions">
            <button
              class="btn btn-primary"
              (click)="changePassword()"
              [disabled]="isSaving()"
            >
              <i class="fa fa-key"></i>
              {{ isSaving() ? "Changing..." : "Change Password" }}
            </button>
          </div>
        </div>
      </div>

      <!-- Profile Tab -->
      <div class="tab-content" *ngIf="activeTab() === 'profile'">
        <div class="form-section">
          <h3 class="section-title">Profile Picture</h3>

          <div class="image-upload-container">
            <div class="image-preview">
              <img
                [src]="imagePreview() || 'assets/images/default-user.png'"
                alt="Profile"
              />
            </div>

            <div class="upload-actions">
              <label class="file-input-label">
                <i class="fa fa-upload"></i>
                Choose Image
                <input
                  type="file"
                  accept="image/jpeg,image/jpg,image/png"
                  (change)="onImageSelected($event)"
                  class="file-input"
                />
              </label>

              <button
                class="btn btn-primary"
                (click)="uploadImage()"
                [disabled]="!selectedImage() || isSaving()"
              >
                <i class="fa fa-check"></i>
                {{ isSaving() ? "Uploading..." : "Upload Image" }}
              </button>

              <p class="upload-hint">Max size: 300KB. Formats: JPG, PNG</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Save Message -->
      <div class="save-message" *ngIf="saveMessage()">
        <i class="fa fa-check-circle"></i>
        {{ saveMessage() }}
      </div>
    </div>
  </div>
</div>
